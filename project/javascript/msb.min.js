var msb={build:function(options){var defaults={animation:true,defaultValue:'',enabled:true,height:'auto',id:'',items:[],onSelect:function(value,text){},scrollHeight:0,width:200};$.extend(defaults,options);var opts=defaults;var fn={};fn.$el=$('#'+opts.id);fn.value=undefined;fn.enabled=true;fn.visible=false;fn.setItem=function(index){var $current=this.$el.find('.msb-current > li'),$newValue=this.$el.find('.msb-items > li').eq(index).find('p');$current.html($newValue.clone());fn.value=$newValue.attr('value');if(options.onSelect){options.onSelect(fn.value,$newValue.html());}};fn.populate=function(){var itemList='',itemLength=opts.items.length,i=0;for(i;i<itemLength;i+=1){var item=opts.items[i];itemList+='<li><p value="'+(item.value||item.text)+'">'+item.text+'</p></li>';}
var structure="<div class='msb-box'><div></div></div><ul class='msb-current'><li><p>"+opts.defaultValue+"</p></li></ul><ul class='msb-items'>"+itemList+"</ul>";this.$el.addClass('msb').html(structure);if(!opts.defaultValue){this.setItem(0);}};fn.setup=function(){this.populate();fn.$items=fn.$el.find('.msb-items');this.$el.width(opts.width).height(opts.height);this.$items.css('display','none').width(opts.width);if(opts.scrollHeight!=0){var realHeight=this.$items.height();if(opts.scrollHeight<=realHeight){this.$items.css({'height':opts.scrollHeight,'overflow-y':'scroll'});}}
var currentHeight=parseInt(this.$el.height(),10),boxWidth=currentHeight*1.5,currentWidth=parseInt(this.$el.width(),10)-boxWidth-1;this.$el.find('.msb-box').height(currentHeight).width(boxWidth);this.$el.find('.msb-current').height(currentHeight).width(currentWidth);var arrowSize=parseInt(this.$el.find('.msb-box > div').css('border-top-width'),10);this.$el.find('.msb-box > div').css({'margin-top':(currentHeight-arrowSize)/2,'margin-left':(boxWidth-(arrowSize*2))/2});};fn.expand=function(){if(opts.animation){this.$items.slideDown('fast');}else{this.$items.css('display','block');}
this.visible=true;};fn.collapse=function(){if(opts.animation){this.$items.slideUp('fast');}else{this.$items.css('display','none');}
this.visible=false;};fn.setup();if(!opts.enabled){fn.enabled=false;fn.$el.addClass('msb-disabled');}
var msbClicked=function(e){e=e||window.event.srcElement;var $target=$(e.target||e.srcElement);if($target.is(fn.$el.find('*'))){if(fn.visible){if($target.is(fn.$el.find('.msb-items > li > p'))){fn.setItem($target.parent().index());}
fn.collapse()}else{if(fn.enabled){fn.expand();}}}else{if(fn.visible){fn.collapse();}}
return true;};$('html').bind('click',msbClicked);var methods={enable:function(){fn.$el.removeClass('msb-disabled');fn.enabled=true;return this;},disable:function(){fn.$el.addClass('msb-disabled');fn.enabled=false;return this;},update:function(obj){if(obj.defaultValue){opts.defaultValue=obj.defaultValue;}
if(obj.items){opts.items=obj.items}
fn.value=undefined;fn.setup();return this;},getValue:function(){return fn.value;},isEnabled:function(){return fn.enabled;}};$('#'+opts.id).data('msb',methods);return methods;},get:function(id){return $('#'+id).data('msb');}};